<template>
    <section class="covidInfos">
        <h2 class="covidInfos__header">Qu'est ce que le COVID-19 ?</h2>
        <p class="covidInfos__summary">Covid-19 fait référence à « Coronavirus Disease 2019 », la maladie provoquée par un virus de la famille des Coronaviridae, 
            le SARS-CoV-2. Cette maladie infectieuse est une zoonose, dont l'origine est encore débattue, qui a émergé en décembre 2019 dans 
            la ville de Wuhan, dans la province du Hubei en Chine. Elle s'est rapidement propagée, d'abord dans toute la Chine, puis à 
            l'étranger provoquant une épidémie mondiale.
        </p>
        <div class="covidInfos__cardsContainer">
            <div class="covidInfos__cardsRow">
                <div class="covidInfosCard covidInfosCard--left">
                    <div class="covidInfosCard__headerContainer"><i class="fas fa-head-side-virus"></i><h3 class="covidInfosCard__header">Causes</h3></div>
                    <ul class="covidInfosCard__list">
                        <li class="covidInfosCard__listItem">La durée de l'incubation est en moyenne de 5 jours, avec des extrêmes de 2 à 12 jours.</li>
                        <li class="covidInfosCard__listItem">Les premiers symptômes sont peu spécifiques : maux de tête, douleurs musculaires, fatigue. La fièvre et les signes respiratoires arrivent secondairement.</li>
                        <li class="covidInfosCard__listItem">Il s'écoule en moyenne une semaine entre l'apparition des premiers symptômes et l'admission à l'hôpital à la phase d'état de la maladie.</li>
                        <li class="covidInfosCard__listItem">La gravité des signes cliniques nécessite le maintien à l'hôpital d'environ 20% des malades et 5% nécessitent une admission en réanimation.</li>
                        <li class="covidInfosCard__listItem">L'infection peut être asymptomatique ou paucisymptomatique (entrainer pas ou peu de manifestations cliniques) chez 30 à 60 % des sujets infectés, en particulier chez les jeunes enfants (moins de 12 ans).</li>
                    </ul>
                </div>
                <div class="covidInfosCard covidInfosCard--right">
                    <div class="covidInfosCard__headerContainer"><i class="fas fa-viruses"></i><h3>Transmission</h3></div>
                    <ul class="covidInfosCard__list">
                        <li class="covidInfosCard__listItem">La transmission se fait essentiellement par voie aérienne (goutelettes de postillons) et passe par un contact rapproché (moins d'un mètre) et durable (au moins 15 mins) avec un sujet contagieux.</li>
                        <li class="covidInfosCard__listItem">Des particules de plus petites tailles peuvent être aussi émises sous formes d'aérosols au cours de la parole, ce qui expliquerait que le virus puisse persister en suspension dans l'air dans une pièce 
                        non ventilée.</li>
                        <li class="covidInfosCard__listItem">Le virus peut conserver une infectiosité pendant quelques heures sur des surfaces inertes d'où il peut être transporté par les mains.</li>
                    </ul>
                </div>
            </div>            
            <div class="covidInfos__cardsRow">
                <div class="covidInfosCard covidInfosCard--left">
                    <div class="covidInfosCard__headerContainer"><i class="fas fa-lungs-virus"></i><h3>Symptômes</h3></div>
                    <ul class="covidInfosCard__list">
                        <li class="covidInfosCard__listItem">La durée de l'incubation est en moyenne de 5 jours, avec des extrêmes de 2 à 12 jours.</li>
                        <li class="covidInfosCard__listItem">Les premiers symptômes sont peu spécifiques : maux de tête, douleurs musculaires, fatigue. La fièvre et les signes respiratoires arrivent secondairement.</li>
                        <li class="covidInfosCard__listItem">Il s'écoule en moyenne une semaine entre l'apparition des premiers symptômes et l'admission à l'hôpital à la phase d'état de la maladie.</li>
                        <li class="covidInfosCard__listItem">La gravité des signes cliniques nécessite le maintien à l'hôpital d'environ 20% des malades et 5% nécessitent une admission en réanimation.</li>
                        <li class="covidInfosCard__listItem">L'infection peut être asymptomatique ou paucisymptomatique (entrainer pas ou peu de manifestations cliniques) chez 30 à 60 % des sujets infectés, en particulier chez les jeunes enfants (moins de 12 ans).</li>
                    </ul>
                </div>
                <div class="covidInfosCard covidInfosCard--right">
                    <div class="covidInfosCard__headerContainer"><i class="fas fa-user-md"></i><h3>Diagnostic</h3></div>
                    <ul class="covidInfosCard__list">
                        <li class="covidInfosCard__listItem">Les tests virologiques (RT-PCR) permettent de déterminer si une personne est porteuse du virus au moment du test grâce à un prélèvement par voie nasale ou salivaire.</li>
                        <li class="covidInfosCard__listItem">Les tests antigéniques rapides constituent ou outil supplémentaire pour réduire les chaînes de transmission virale. Ils viennent en complément des tests RT-PCR. Ce test est prioritairement réservé aux personnes symptomatiques.</li>
                        <li class="covidInfosCard__listItem">Les tests sérologiques permettent de rechercher si une personne a développé une réaction immunitaire après avoir été en contact avec le virus.</li>
                    </ul>
                </div>
            </div>            
            <div class="covidInfos__cardsRow">
                <div class="covidInfosCard covidInfosCard--left">
                    <div class="covidInfosCard__headerContainer"><i class="fas fa-shield-virus"></i><h3>Précautions et prévention</h3></div>
                    <ul class="covidInfosCard__list">
                        <li class="covidInfosCard__listItem">Se laver les mains régulièrement (eau+savon) ou utilisez une solution hydroalcoolique.</li>
                        <li class="covidInfosCard__listItem">Tousser ou éternuer dans votre coude ou dans un mouchoir.</li>
                        <li class="covidInfosCard__listItem">Eviter de se toucher le visage.</li>
                        <li class="covidInfosCard__listItem">Utiliser des mouchoirs à usage unique (et les jeter à la poubelle après le premier usage).</li>
                        <li class="covidInfosCard__listItem">Saluer sans serrer la main et sans embrassades.</li>
                        <li class="covidInfosCard__listItem">Conserver une distance d'au moins 1.5m avec tout interlocuteur.</li>
                        <li class="covidInfosCard__listItem">Bien arérer les pièces.</li>
                    </ul>
                </div>
                <div class="covidInfosCard covidInfosCard--right">
                    <div class="covidInfosCard__headerContainer"><i class="far fa-hospital"></i><h3>Prise en charge et traitement</h3></div>
                    <ul class="covidInfosCard__list">
                        <li class="covidInfosCard__listItem">J'ai des symptômes (toux, fièvres) qui me font penser au COVID-19: Je reste à domicile, j'évite les contacts. Je prends contact avec mon médecin traitant qui pourra 
                            me proposer une consultation et un test de diagnostic en fonction des symptômes que je présente.
                        </li>
                        <li class="covidInfosCard__listItem">J'ai des symptômes qui s'aggravent avec des difficultés respiratoires et signes d'étouffement: J'appelle le SAMU qui décidera de la conduite à venir. J'évite tout contact 
                            avec l'entourage, je ne me rends pas chez mon médecin taitant ou aux urgences pour éviter toute potentielle contamination. je limite mes déplacements au strict nécessaire.
                        </li>
                    </ul>
                </div>
            </div>
        </div>       
    </section>
    <section class="covidTips infoSection">
        <div class="infoSection__container">
            <h2>Aidez à combattre la pandémie</h2>
            <p>La meilleure manière d'en finir est de se renseigner !</p>
            <a :href="covidDefinitionUrl" title="En savoir plus sur le COVID-19">En savoir plus sur le COVID-19 <i class="fas fa-external-link-alt"></i></a>
            <a :href="covidMythsUrl" title="Idées reçues sur le COVID-19">Idées reçues sur le COVID-19 <i class="fas fa-external-link-alt"></i></a>
            <a :href="covidGuidelinesUrl" title="Recommandations de l'OMS">Recommandations de l'OMS <i class="fas fa-external-link-alt"></i></a>
        </div>
    </section>
    <section>
        <div class="infoSection">
            <div class="infoSection__container">
                <h2>La France a enregistré <span>{{ worldDatas.France.All.confirmed }}</span> cas confirmés de coronavirus</h2>
                <p>Par conséquent {{ franceInfectionRate }} de la population est ou a été infectée par le COVID-19, toutefois ce chiffre ne concerne 
                    que les test en laboratoires, le chiffre réel est très probablement plus élevé.
                </p>
            </div>
            
        </div>
        <div class="infoSection worldSummary">
            <div class="infoSection__container">
                <h2>Il y a <span>{{ worldDatas.Global.All.confirmed }}</span> cas confirmés de COVID-19 à travers le monde</h2>
                <p>Depuis la semaine dernière c'est une {{ worldConfirmedCasesTrend }} de {{ worldConfirmedCasesDifference }} cas, soit {{ worldWeekTotalConfirmedCasesPercentage }}</p>
                <p>Depuis le début de la pandémie, <span class="infoSection__deathsNumber">{{ worldDatas.Global.All.deaths }}</span> sont morts du COVID-19, faisant s'élevé le taux de mortalité à {{ worldMortalityRate }}
                    alors qu'en comparaison le taux de mortalité de la grippe saisonnière est de 0.1% aux U.S (New York Times).
                </p>
            </div>
        </div>
    </section>
</template>

<script>
import { computed } from "vue";
import { useStore } from "vuex";

//JS Files
//import DatasCalculator from "../../assets/JSClasses/DatasCalculator.js"

export default {
    setup() {

        //Vuex
        const store = useStore();
        let worldDatas = computed(() => store.state.worldDatas);
        let worldEvolutionDatas = computed(() => store.state.worldEvolutionDatas.Global);

        //Computed variables
        let franceInfectionRate = computed(() => {
            
            let infectionRate = 100 * (worldDatas.value.France.All.confirmed / worldDatas.value.France.All.population);
            return infectionRate + "%";

        });
        let worldConfirmedCasesDifference = computed(() => {

            let mostRecentDayData;
            let weekAgoData;
            let i = 1;

            console.log(worldEvolutionDatas);

            for (const [key, value] of Object.entries(worldEvolutionDatas.value.confirmed)) {

                console.log(key);

                if (i === 1) {
                    mostRecentDayData = value;
                } else if (i === 7) {
                    weekAgoData = value;
                    break;
                }

                i++;

            }

            return mostRecentDayData - weekAgoData;

        });
        let worldConfirmedCasesTrend = computed(() => {

            if (worldConfirmedCasesDifference.value > 0) {
                return "augmentation";
            } else if (worldConfirmedCasesDifference.value < 0) {
                return "diminution"
            } else {
                return "erreur";
            }

        });

        let worldWeekTotalConfirmedCasesPercentage = computed(() => {

            let data = 100 * (worldConfirmedCasesDifference.value / worldDatas.value.Global.All.confirmed);
            return data + "%";

        });

        let worldMortalityRate = computed(() => {

            let data = 100 * (worldDatas.value.Global.All.deaths / worldDatas.value.Global.All.population);
            return data + "%";

        });

        //External Links
        const covidDefinitionUrl = "https://www.pasteur.fr/fr/centre-medical/fiches-maladies/maladie-covid-19-nouveau-coronavirus";
        const covidMythsUrl = "https://www.who.int/fr/emergencies/diseases/novel-coronavirus-2019/advice-for-public/myth-busters";
        const covidGuidelinesUrl = "https://www.who.int/emergencies/diseases/novel-coronavirus-2019/advice-for-public";

        return {
            worldDatas,
            franceInfectionRate,
            worldConfirmedCasesDifference,
            worldConfirmedCasesTrend,
            worldWeekTotalConfirmedCasesPercentage,
            worldMortalityRate,
            covidDefinitionUrl,
            covidMythsUrl,
            covidGuidelinesUrl
        }

    }  
}
</script>

<style lang="scss">
.covidInfos {
    background-color: #F3F3F3;
    &__summary {
        width: 40%;
    }
    &__cardsContainer {
        padding-bottom: 250px;
    }
    &__cardsRow {
        flex-direction: row-reverse;
        display: flex;
        align-items: center;
        > div {
            flex: 1;
        }
    }
}

.covidInfosCard {
    background-color: white;
    border-radius: 20px;
    margin: 1rem;
    position: relative;
    padding: 1rem;
    &--left {
        bottom: 0px;
    }
    &--right {
        top: 250px;
    }
    &__headerContainer {
        display: flex;
        align-items: center;
        position: relative;
        left: 5%;
        > i {
            margin-right: 0.5rem;
        }
    }
    &__listItem {
        margin: 1rem 0;
    }
}

.infoSection {
    min-height: 400px;
    display: flex;
    align-items: center;
    justify-content: center;
    &__container {
        width: 45%;
        position: relative;
        right: 17%;
    }
    &__deathsNumber {
        color: #EB4647;
        font-size: 1.2rem;
    }
}

.covidTips {
    background-color: #246EB9;
    color: white;
    a {
        background-color: red;
        border-radius: 10px;
        padding: 0.5rem 1rem;
        margin: 1rem;
    }
}

.worldSummary {
    background-color: #F3F3F3;
}
</style>